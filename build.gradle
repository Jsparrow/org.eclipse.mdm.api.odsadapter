description = 'MDM API - ODSAdapter'
group = 'org.eclipse.mdm'
version = '1.0.0'

apply plugin: 'java'
apply plugin: 'maven'
apply plugin: 'eclipse'


repositories {
	mavenLocal()
    mavenCentral()
}

sourceSets {
    generated {
        java {
            srcDir 'src/gen/java'
        }
    }
    
    main {
        compileClasspath += generated.output
        runtimeClasspath += generated.output
    }
    
    test {
        compileClasspath += generated.output
        runtimeClasspath += generated.output
    }
}

dependencies {
	// logging	
	compile 'org.slf4j:slf4j-api:1.7.19'
	
	// MDM5 API
	compile 'org.eclipse.mdm:org.eclipse.mdm.api.base:1.0.0'
	compile 'org.eclipse.mdm:org.eclipse.mdm.api.default:1.0.0'
	
	// compile CORBA idl using JDK tools
    generatedCompile files(System.getenv('JAVA_HOME') + '/lib/tools.jar')
    
    // testing
    testCompile 'junit:junit:4.12'
	testRuntime 'org.slf4j:slf4j-simple:1.7.19'
}

test {
	jvmArgs '-Dorg.slf4j.simpleLogger.defaultLogLevel=debug'
}

task compileIDL(type: JavaExec) {
    classpath = configurations.generatedCompile

    main = 'com.sun.tools.corba.se.idl.toJavaPortable.Compile'
    
 	// add 'fallTIE' if <Type>POA & <Type>POATie have to be generated   
    args '-td', 'src/gen/java/', 'src/main/idl/ods530.idl'
}

// generate classes from idl and compile them
compileGeneratedJava.dependsOn compileIDL
compileJava.dependsOn compileGeneratedJava

jar {
    from sourceSets.generated.output
    dependsOn generatedClasses
}

task deleteGenerated(type: Delete) {
    delete 'src/gen/'
}

clean.dependsOn deleteGenerated